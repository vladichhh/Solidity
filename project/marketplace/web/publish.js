var Web3 = require("web3");
var web3 = new Web3(new Web3.providers.HttpProvider("http://127.0.0.1:9545"));

// get the first account
var acc = web3.eth.accounts[0];

// contract's ABI
var abi = [{"constant":false,"inputs":[{"name":"productId","type":"bytes32"},{"name":"quantity","type":"uint256"}],"name":"buy","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"productId","type":"bytes32"}],"name":"getProduct","outputs":[{"name":"name","type":"string"},{"name":"price","type":"uint256"},{"name":"quantity","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"destroy","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"productId","type":"bytes32"},{"name":"newQuantity","type":"uint256"}],"name":"update","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getProducts","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"productId","type":"bytes32"},{"name":"quantity","type":"uint256"}],"name":"getPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"name","type":"string"},{"name":"price","type":"uint256"},{"name":"quantity","type":"uint256"}],"name":"newProduct","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"recipient","type":"address"}],"name":"destroyAndSend","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"productId","type":"bytes32"},{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"price","type":"uint256"},{"indexed":false,"name":"quantity","type":"uint256"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"ProductAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"productId","type":"bytes32"},{"indexed":false,"name":"price","type":"uint256"},{"indexed":false,"name":"quantity","type":"uint256"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"ProductPurchased","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"productId","type":"bytes32"},{"indexed":false,"name":"initQuantity","type":"uint256"},{"indexed":false,"name":"newQuantity","type":"uint256"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"ProductUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"Withdrawal","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"previousOwner","type":"address"},{"indexed":false,"name":"newOwner","type":"address"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"OwnershipTransferred","type":"event"}]

// contract's bytecode
var bytecode = "6060604052336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506112c9806100536000396000f3006060604052600436106100ba576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630ddeb632146100bf57806312065fe0146100e45780633a20e9df1461010d5780633ccfd60b146101bb57806383197ef0146101d05780638da5cb5b146101e5578063a58bb84a1461023a578063c29b2f201461026a578063c9280f06146102d4578063e6f2642514610318578063f2fde38b146103a3578063f5074f41146103dc575b600080fd5b6100e2600480803560001916906020019091908035906020019091905050610415565b005b34156100ef57600080fd5b6100f76105da565b6040518082815260200191505060405180910390f35b341561011857600080fd5b610132600480803560001916906020019091905050610654565b6040518080602001848152602001838152602001828103825285818151815260200191508051906020019080838360005b8381101561017e578082015181840152602081019050610163565b50505050905090810190601f1680156101ab5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b34156101c657600080fd5b6101ce61079d565b005b34156101db57600080fd5b6101e36108dd565b005b34156101f057600080fd5b6101f8610972565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561024557600080fd5b610268600480803560001916906020019091908035906020019091905050610997565b005b341561027557600080fd5b61027d610acc565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156102c05780820151818401526020810190506102a5565b505050509050019250505060405180910390f35b34156102df57600080fd5b610302600480803560001916906020019091908035906020019091905050610b2e565b6040518082815260200191505060405180910390f35b341561032357600080fd5b610385600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091908035906020019091908035906020019091905050610b9e565b60405180826000191660001916815260200191505060405180910390f35b34156103ae57600080fd5b6103da600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610e25565b005b34156103e757600080fd5b610413600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610fbf565b005b6000808360016000826000191660001916815260200190815260200160002060030160009054906101000a900460ff16151561045057600080fd5b60003411151561045f57600080fd5b848460008111151561047057600080fd5b80600160008460001916600019168152602001908152602001600020600201541015151561049d57600080fd5b6104ca86600160008a6000191660001916815260200190815260200160002061103390919063ffffffff16565b94508434101515156104db57600080fd5b61050886600160008a6000191660001916815260200190815260200160002061105490919063ffffffff16565b86600019167fe891d7db57f1ff30e2ca6ed35db8686f6656563c261c4337b5da639c1ec9ebfc600160008a6000191660001916815260200190815260200160002060010154884260405180848152602001838152602001828152602001935050505060405180910390a2610585853461107790919063ffffffff16565b935060008411156105d1573373ffffffffffffffffffffffffffffffffffffffff166108fc859081150290604051600060405180830381858888f1935050505015156105d057600080fd5b5b50505050505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561063757600080fd5b3073ffffffffffffffffffffffffffffffffffffffff1631905090565b61065c61113a565b6000808360016000826000191660001916815260200190815260200160002060030160009054906101000a900460ff16151561069757600080fd5b6001600086600019166000191681526020019081526020016000206000016001600087600019166000191681526020019081526020016000206001015460016000886000191660001916815260200190815260200160002060020154828054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107885780601f1061075d57610100808354040283529160200191610788565b820191906000526020600020905b81548152906001019060200180831161076b57829003601f168201915b50505050509250935093509350509193909250565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156107fa57600080fd5b60003073ffffffffffffffffffffffffffffffffffffffff163111151561082057600080fd5b3073ffffffffffffffffffffffffffffffffffffffff163190506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561089b57600080fd5b7fbf2ed60bd5b5965d685680c01195c9514e4382e28e3a5a2d2d5244bf59411b938142604051808381526020018281526020019250505060405180910390a150565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561093857600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156109f457600080fd5b8260016000826000191660001916815260200190815260200160002060030160009054906101000a900460ff161515610a2c57600080fd5b600160008560001916600019168152602001908152602001600020600201549150610a7a8360016000876000191660001916815260200190815260200160002061109090919063ffffffff16565b83600019167f860eda047ac10322765362311e939948945131be62dc2eb75c03bb4f967434a583854260405180848152602001838152602001828152602001935050505060405180910390a250505050565b610ad461114e565b6002805480602002602001604051908101604052809291908181526020018280548015610b2457602002820191906000526020600020905b81546000191681526020019060010190808311610b0c575b5050505050905090565b60008260016000826000191660001916815260200190815260200160002060030160009054906101000a900460ff161515610b6857600080fd5b610b958360016000876000191660001916815260200190815260200160002061103390919063ffffffff16565b91505092915050565b6000806000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610bfc57600080fd5b600084111515610c0b57600080fd5b8484846040518084805190602001908083835b602083101515610c435780518252602082019150602081019050602083039250610c1e565b6001836020036101000a03801982511681845116808217855250505050505090500183815260200182815260200193505050506040518091039020905060016000826000191660001916815260200190815260200160002060030160009054906101000a900460ff16151515610cb857600080fd5b610cc385858561109d565b6001600083600019166000191681526020019081526020016000206000820151816000019080519060200190610cfa929190611162565b50602082015181600101556040820151816002015560608201518160030160006101000a81548160ff02191690831515021790555090505060028054806001018281610d4691906111e2565b91600052602060002090016000839091909150906000191690555080600019167f767c6434f0cb0b7f4bb789de7132bc6e6a94ffa0657db452ad90e707c7e460f8868686426040518080602001858152602001848152602001838152602001828103825286818151815260200191508051906020019080838360005b83811015610ddd578082015181840152602081019050610dc2565b50505050905090810190601f168015610e0a5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390a2809150509392505050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610e8057600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614151515610ebc57600080fd5b7fc13a1166d81cd3b0b352a367aebab95f3a6f6bc695fdab8e9a9d335239c3861b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff168242604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561101a57600080fd5b8073ffffffffffffffffffffffffffffffffffffffff16ff5b600061104c8284600101546110db90919063ffffffff16565b905092915050565b61106b81836002015461107790919063ffffffff16565b82600201819055505050565b600082821115151561108557fe5b818303905092915050565b8082600201819055505050565b6110a561120e565b6080604051908101604052808581526020016110c085611116565b81526020018381526020016001151581525090509392505050565b60008060008414156110f0576000915061110f565b828402905082848281151561110157fe5b0414151561110b57fe5b8091505b5092915050565b6000611133670de0b6b3a7640000836110db90919063ffffffff16565b9050919050565b602060405190810160405280600081525090565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106111a357805160ff19168380011785556111d1565b828001600101855582156111d1579182015b828111156111d05782518255916020019190600101906111b5565b5b5090506111de919061123f565b5090565b815481835581811511611209578183600052602060002091820191016112089190611264565b5b505050565b608060405190810160405280611222611289565b815260200160008152602001600081526020016000151581525090565b61126191905b8082111561125d576000816000905550600101611245565b5090565b90565b61128691905b8082111561128257600081600090555060010161126a565b5090565b90565b6020604051908101604052806000815250905600a165627a7a723058201177cb302413a929b8ab8266ee30406796122862c778b0aff62df938a6cb2d590029"

// creates the contract instance. We can use this instance to publish or connect to a published contract
var Contract = web3.eth.contract(abi);

// creates a JS Object (key-value pairs), holding the data we need to publish our contract
var publishData = {
	"from": acc, 		// the account from which it will be published
	"data": bytecode,	// contract's bytecode
	"gas": 4000000 		// gas limit - this should be the same or lower than Ethereum's gas limit
}

// publish the contract, passing a callback that will be called twice. Once when the transaction is sent, 
// and once when it is mined (the first argument is the constructor argument)
Contract.new(publishData, function(err, contractInstance) {
	if (!err) {
		if (contractInstance.address) {
			// if the contract has an address aka if the transaction is mined
			console.log("New contract address is: ", contractInstance.address);
		}
	} else {
		// something went wrong
		console.error(err);
	}
});
